#!/usr/sbin/nft -f

flush ruleset

table ip filter {
	counter dropped_input_packet_v4 {}

	chain INPUT {
		type filter hook input priority 0; policy drop;

        # accept all loopback packets
        iif "lo" accept

		# accept all icmp/icmpv6 packets
        ip protocol icmp accept

        # accept all packets that are part of an already-established connection
        ct state established,related accept

        # SSH
        tcp dport ssh accept

        # BGP
        tcp dport bgp accept

        # reject with polite "port unreachable" icmp response
		counter name dropped_input_packet_v4 reject with icmp type host-unreachable comment "count dropped packets"
	}

	chain FORWARD {
		type filter hook forward priority 0; policy drop;
	}

	chain OUTPUT {
		type filter hook output priority 0;
	}
}

table ip6 filter {
	counter dropped_input_packet_v6 {}

	chain INPUT {
		type filter hook input priority 0; policy drop;

        # accept all loopback packets
        iif "lo" accept

	# accept all icmp/icmpv6 packets
        ip6 nexthdr ipv6-icmp accept
	icmpv6 type { nd-neighbor-solicit, echo-request, nd-router-advert, nd-neighbor-advert } accept

        # accept all packets that are part of an already-established connection
        ct state established,related accept

        # SSH
        tcp dport ssh accept

        # BGP
        tcp dport bgp accept

        # reject with polite "port unreachable" icmp response
		counter name dropped_input_packet_v6 reject with icmpv6 type port-unreachable comment "count dropped packets"
	}

	chain FORWARD {
		type filter hook forward priority 0; policy drop;
	}

	chain OUTPUT {
		type filter hook output priority 0;
	}
}
